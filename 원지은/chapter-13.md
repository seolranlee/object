# 서브클래싱과 서브타이핑

## 상속의 용도

1. 타입 계층 구현
2. 코드 재사용

동일한 메시지에 대해 서로 다르게 행동할 수 있는 다형적인 객체를 구현하기 위해서 객체의 행동을 기반으로 타입 계층을 구성해야 한다.

## 타입

### 개념 관점의 타입

- 개념 관점에서 타입이란 우리가 인지하는 세상의 사물의 종류를 의미한다.

### 프로그래밍 언어 관점의 타입

- 프로그래밍 언어 관점에서 타입은 연속적인 비트에 의미와 제약을 부여하기 위해 사용된다.

### 객체지향 패러다임 관점의 타입

- 객체의 퍼블릭 인터페이스가 객체의 타입을 결정한다.
  - 동일한 퍼블릭 인터페이스를 제공하는 객체들은 동일한 타입으로 분류된다.

## 타입 계층

- 타입 계층을 표현할 때는 더 일반적인 타입(supertype)을 위쪽에, 더 특수한 타입(subtype)을 아래쪽에 배치하는 것이 관례다.
- 객체의 타입을 결정하는 것은 퍼블릭 인터페이스이다.
- 서브타입의 인스턴스는 슈퍼타입의 인스턴스로 간주될 수 있다.

## 서브클래싱(subclassing)과 서브타이핑(subtyping)

### 언제 상속을 사용해야 하는가?

- 상속 관계가 is-a 관계를 모델링할 때
  - "자식 클래스는 부모 클래스다"라고 말해도 이상하지 않다. 대신 사용할 수 있다.
- 클라이언트 입장에서 부모 클래스의 타입으로 자식 클래스를 사용해도 무방할 때
  - 상속 계층을 사용하는 클라이언트의 입장에서 부모 클래스와 자식 클래스의 차이점을 몰라야 한다. 이를 자식 클래스와 부모 클래스 사이의 행동 호환성이라고 부른다.

### 행동 호환성

- 타입은 행동과 관련이 있다.
- 두 타입 사이에 행동이 호환될 경우에만 타입 계층으로 묶어야 한다.
  - 행동의 호환 여부를 판단하는 기준은 클라이언트의 관점이다.
- 인터페이스를 클라이언트의 기대에 따라 분리함으로써 변경에 의해 영향을 제어하는 설계 원칙을 인터페이스 분리 원칙 (Interface Segregation Principle, ISP)이라고 한다.
  - 예) 펭귄, 새

### 서브클래싱

- 다른 클래스의 코드를 재사용할 목적으로 상속을 사용하는 경우
- 구현 상속, 클래스 상속

### 서브타이핑

- 타입 계층을 구성하기 위해 상속을 사용하는 경우.
- 인터페이스 상속
- 어떤 타입이 다른 타입의 서브타입이 되기 위해서는 행동 호환성을 만족해야 한다.
  - 자식 클래스와 부모 클래스 사이의 행동 호환성은 부모 클래스에 대한 자식 클래스의 대체 가능성을 포함한다.

### 리스코프 치환 원칙

- 상속 관계로 연결한 두 클래스가 서브타이핑 관계를 만족시키기 위해서는 리스코프 치환 원칙을 만족해야 한다.
- 자식 클래스가 부모 클래스와 행동 호환성을 유지함으로써 부모 클래스를 대체할 수 있도록 구현된 상속 관계만을 서브타이핑이라고 부를 수 있다.
- 클라이언트 관점에서 행동이 호환되는지 여부를 판단하는 것이 중요하다.
  - 상속 관계는 클라이언트의 관점에서 자식 클래스가 부모 클래스를 대체할 수 있을 때만 올바르다.
  - 대체 가능성을 결정하는 것은 클라이언트다.
- 예) 정사각형, 직사각형 -> 서브클래싱 관계

### 타입 계층과 리스코프 치환 원칙

- 동적 타입 언어의 덕 타이핑 등의 기법을 사용하면 클래스 사이의 상속을 사용하지 않고 서브타이핑 관계를 구현할 수 있다.

## 계약에 의한 설계와 서브타이핑

- 서브타입이 리스코프 치환 원칙을 만족시키기 위해서는 클라이언트와 슈퍼타입 간에 체결된 '계약'을 준수해야 한다.
- 계약에 의한 설계(Design by Contract, DBC)는 클라이언트와 서버 사이의 의무와 권리를 명확하게 정의함으로써 서브타이핑 관계를 유지할 수 있도록 한다.

- 사전조건: 메서드가 실행되기 전에 만족되어야 하는 조건
- 사후조건: 메서드가 실행된 후에 만족되어야 하는 조건
- 클래스 불변식: 메서드 실행 전과 실행 후에 인스턴스가 만족시켜야 하는 조건

### 서브타입과 계약

- 서브타입에 더 강력한 사전조건을 정의할 수 없다.
- 서브타입에 슈퍼타입과 같거나 더 약한 사후조건을 정의할 수 없다.
- 서브타입에 슈퍼타입과 같거나 더 강한 사후조건을 정의할 수 있다.
- 서브타입에 더 약한 사후조건을 정의할 수 없다.
