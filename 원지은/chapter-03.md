# 역할, 책임, 협력

애플리케이션의 기능을 구현하기 위해 어떤 협력이 필요하고 협력을 위해 어떤 역할과 책임이 필요한지를 고민하지 않은 채 너무 이른 시기에 구현에 초점을 맞추는 것은 변경하기 어렵고 유연하지 못한 코드를 낳는 원인이 된다.

## 협력

1. 시스템의 기능이라는 더 큰 목표를 달성하기 위해 다른 객체와 협력
2. 객체지향의 세계에서 기능을 구현할 수 있는 유일한 방법
3. 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단은 메시지 전송. 메시지를 수신한 객체는 메서드를 실행해 요청에 응답

    ```text
    ex. `order.calculatePrice()`에서 `order`는 `calculatePrice` 메시지를 전송하는 객체이고, `calculatePrice`는 `order`가 수신한 메시지에 대한 응답으로 수행하는 행동이다.
    ```

4. 어떤 객체가 다른 객체에게 무엇인가를 요청하는 것
5. 두 객체가 상호작용을 통해 더 큰 책임을 수행하는 것

### 문맥(Context) 제공

객체가 협력에 참여하기 위해 필요한 정보를 캡슐화하고 이를 통해 객체가 협력에 참여하는 방식을 결정

### 자율적인 객체

1. 객체는 자율적이어야 한다.
2. 객체는 스스로의 상태를 책임져야 한다.
3. 객체의 자율성을 보장하기 위해서는 필요한 정보와 그 정보에 기반한 행동을 함께 묶어야 한다.
은닉? 객체의 상태를 직접 변경하는 것이 아니라 객체에게 메시지를 전송해 상태를 변경하도록 요청
4. 캡슐화? 객체의 상태를 변경하는 메서드를 객체 내부로 숨기고 객체가 제공하는 메시지를 통해서만 상태를 변경할 수 있게 함
5. 객체의 자율성을 높이기 위해서는 객체가 결정을 내릴 수 있는 정보와 행동을 함께 묶어야 한다.

### 결합도 느슨하게 유지

객체 사이의 결합도를 낮추는 가장 좋은 방법은 객체가 협력에 참여하는 방법을 자율적으로 결정할 수 있도록 객체 내부에 숨겨진 상태를 캡슐화하는 것

## 책임

하는 것(doing)과 아는 것(knowing)으로 구분

### 책임 할당

- 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것
- 책임을 할당하는 것은 객체가 수행할 책임을 결정하는 것이다.
- 일상 생활에서 도움을 요청하는 방식과 유사
  - 특히 업무를 요청할 때는 업무를 잘 아는 사람에게 요청
  - 업무를 잘 아는 사람이 업무를 수행하는 것이 효율적이기 때문

### 책임을 할당하는 방법

1. 객체에게 전송하는 메시지의 이름을 결정

    ```text
    ex. `calculatePrice`라는 메시지 이름
    ```

2. 메시지를 처리할 적절한 객체를 선택
    - 기본 전략은 가장 잘 알고 있는 정보 전문가에게 책임을 할당

    ```text
    ex. `Order` 객체가 `calculatePrice` 메시지를 처리
    ```

3. 1, 2번의 반복...

- 객체지향 설계는 협력에 필요한 메시지를 찾고(1), 메시지에 적절한 객체를 선택(2)하는 반복적인 과정을 통해 이뤄짐
- 메시지가 수신할 객체의 책임을 결정

### 책임 주도 설계 (Responsibility-Driven Design, RDD)

시스템이 사용자에게 제공해야 하는 기능을 파악하고,
그 기능을 더 작은 책임으로 분할하고,
해당 책임을 수행할 수 있는 적절한 객체를 찾아 책임을 할당하는 방법

### 책임 주도 설계의 장점

1. 협력 강화: 협력이라는 문맥 안에서 객체의 책임을 결정하므로 협력에 필요한 책임을 명확하게 식별할 수 있음
2. 작업의 목적 명확: 책임을 수행할 객체를 선택하기 위해 객체 사이의 협력 관계를 명확하게 정의할 수 있음
3. 변화에 대한 안정성: 객체가 협력에 참여하는 방식을 결정하는 것은 객체의 내부 구현이 아니라 객체의 외부 인터페이스에 초점을 맞추는 것을 의미하므로 객체의 내부 구현을 외부로부터 캡슐화할 수 있음. 따라서 객체의 내부 구현이 변경되더라도 객체 사이의 협력 관계에는 영향을 미치지 않음
4. 재사용성: 객체의 자율성을 높이고 결합도를 낮출 수 있음

### 책임 주도 설계의 단점

1. 책임을 할당할 객체를 선택하는 것이 쉽지 않을 수 있음
2. 협력을 설계하는 것이 어려울 수 있음

응집도

응집도란 한 모듈 내에 필요한 함수와 데이터들의 친화력을 측정하는 척도이다. 한 모듈의 응집도가 높을수록 모듈에 필요한 함수와 데이터들이 그 모듈 내에 존재할 확률이 높으며, 응집도가 낮을수록 모듈 내에 서로 관련없는 함수나 데이터들이 존재한다. 응집도는 정보 은닉 개념을 확장한 것으로서, 응집력이 있는 모듈은 프로그램의 다른 부분을 수행하는 다른 프로시저들과의 상호작용이 거의 없이 한 프로시저 내에서 하나의 임무를 수행할 수 있다.

## 역할

- 객체가 협력에 참여하기 위해 수행하는 책임의 집합
- 중복된 책임을 추상화한 것

### 역할을 정의하는 방법

추상화

- 추상화는 다양한 특징을 가진 존재들을 보다 단순하게 정리하고, 그 사이의 공통점을 찾는 것
- 추상화는 객체들의 공통된 특징을 추출하여 정의하는 것
- 타입을 정의하는 것이 추상화의 핵심

추상 클래스, 인터페이스

- 일반 클래스와 달리 객체 생성 불가
- 하위 클래스 혹은 구현 클래스에서 추상 메서드를 구현하도록 강제
- 인터페이스는 추상 메서드와 상수만을 가질 수 있다.

    ```java
    public interface Role {
        static final int MAX_AGE = 20;
        void play();
    }
    public class Dog implements Role {
        @Override
        public void play() {
            System.out.println("멍멍!");
        }
    }
    public class Main {
        public static void main(String[] args) {
            Animal myDog = new Dog();
            myDog.play(); // 멍멍!
            System.out.println(Animal.MAX_AGE + "세입니다."); // 20세입니다.
        }
    }
    ```

- 추상 클래스는 공통된 기능을 제공하고 개별화를 가능하게 하여 사용자가 자신의 방식으로 오버라이딩할 수 있도록 한다.
  
    ```java
    public abstract class Role {
        public abstract void makeSound();
        public void play() {
            System.out.println("Role");
        }
    }
    public class Dog extends Role {
        @Override
        public void makeSound() {
            System.out.println("멍멍!");
            play();
        }
    }
    public class Main {
        public static void main(String[] args) {
            Role myDog = new Dog();
            myDog.makeSound(); // 멍멍! Role
        }
    }
    ```

| 차이점 | 추상 클래스(abstrct) | 인터페이스(interface) |
| --- | --- | --- |
| 상속 가능성 | 하위 클래스에 상속 (extends) | O (implements) |
| 다중 상속 가능성 | O | X |
| 생성자와 일반 변수 포함 | O | X |

### 객체 vs 역할

확실하면 역할로 시작, 불확실하면 객체로 시작

1. 설계 초반에는 적절한 책임과 협력의 큰 그림을 탐색
2. 단순하게 객체로 시작하고 반복적으로 책임과 협력을 정제
3. 동일한 책임을 서로 다른 방식으로 수행할 수 있는 객체들이 생기면 역할을 도입

다양한 시나리오를 탐색하고 유사한 협력들을 단순화하고 합치다 보면 자연스럽게 역할이 모습을 드러낸다.

### 역할과 추상화

- 역할은 추상화를 통해 정의된다.
- 추상화는 세부 사항에 억눌리지 않고 상위 수준의 정책을 쉽고 간단하게 표현할 수 있다.
- 객체에게 중요한 것은 핸동, 역할이 중요한 이유는 동일한 협력을 수행하는 객체를 추상화
- 역할이 다양한 종류의 객체를 끼워 넣을 수 있는 일종의 슬롯으로 동작하여 설계를 유연하게 만든다.
- 역할은 객체의 페르소나
